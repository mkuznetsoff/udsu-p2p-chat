–ü—Ä–∏–≤–µ—Ç! –û—Ç–ª–∏—á–Ω–æ, —á—Ç–æ —É —Ç–µ–±—è —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç P2P-—á–∞—Ç —Å UDP hole punching –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Ä–æ–ª—å—é —Å–µ—Ä–≤–µ—Ä–∞. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞ –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ ‚Äî —Ö–æ—Ä–æ—à–∞—è –∏–¥–µ—è –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —É–¥–æ–±—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –í–æ—Ç –∫–∞–∫ —Ç—ã –º–æ–∂–µ—à—å —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

üîê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
–ü–æ—Å–∫–æ–ª—å–∫—É —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å RSA, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–∏–º–µ–Ω—è—Ç—å –≥–∏–±—Ä–∏–¥–Ω—É—é —Å—Ö–µ–º—É —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:

–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π: –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —à–∏—Ñ—Ä—É–µ—Ç—Å—è —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, AES).

–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–∞: –°–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –∫–ª—é—á —à–∏—Ñ—Ä—É–µ—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—É–±–ª–∏—á–Ω–æ–≥–æ RSA-–∫–ª—é—á–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è.

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —Ç–∞–∫ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –ø–æ—Å–∫–æ–ª—å–∫—É RSA –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö .

üìÅ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
–î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –ø–æ–¥—Ö–æ–¥:

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö: –•—Ä–∞–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, –≥–¥–µ –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª—è: –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å, –ø–æ–ª—É—á–∞—Ç–µ–ª—å, –º–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –∫–ª—é—á.

–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ: –í–µ—Å—å —Ñ–∞–π–ª JSON –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —à–∏—Ñ—Ä—É–µ—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞, –∫–æ—Ç–æ—Ä—ã–π –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å —à–∏—Ñ—Ä—É–µ—Ç—Å—è RSA-–∫–ª—é—á–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

ZIP-–∞—Ä—Ö–∏–≤: –ü–æ–ª—É—á–µ–Ω–Ω—ã–π –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ ZIP-–∞—Ä—Ö–∏–≤ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–¥–∞—á–∏.

üîÑ –ò–º–ø–æ—Ä—Ç –∏ —ç–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏
–≠–∫—Å–ø–æ—Ä—Ç:

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏.

–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–µ–∫—É—â–∏—Ö –∫–ª—é—á–µ–π –∏ –Ω–∏–∫–æ–≤.

–ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞, –∏—Å—Ç–æ—Ä–∏—è —à–∏—Ñ—Ä—É–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ ZIP-–∞—Ä—Ö–∏–≤.

–ò–º–ø–æ—Ä—Ç:

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç ZIP-–∞—Ä—Ö–∏–≤ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞.

–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç —Ñ–∞–π–ª –∏—Å—Ç–æ—Ä–∏–∏, –ø—Ä–æ–≤–µ—Ä—è—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–ª—é—á–µ–π –∏ –Ω–∏–∫–æ–≤.

–ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞, –∏—Å—Ç–æ—Ä–∏—è –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–∏–π —á–∞—Ç.

üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è: –ü–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º –∏–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–ª—é—á–∏ –∏ –Ω–∏–∫–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å —Ç–µ–∫—É—â–∏–º–∏.

–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö: –î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ü–∏—Ñ—Ä–æ–≤—ã–µ –ø–æ–¥–ø–∏—Å–∏ –∏–ª–∏ —Ö—ç—à-—Ñ—É–Ω–∫—Ü–∏–∏.

–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–º–µ–Ω—ã: –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–ª–µ–¥—É–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ü–∏—Ñ—Ä–æ–≤—ã–µ –ø–æ–¥–ø–∏—Å–∏, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è –≤ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.

üß© –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (Python)
–í–æ—Ç –ø—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, –∫–∞–∫ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Python:

python
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
import json
import zipfile
from Crypto.PublicKey import RSA
from Crypto.Cipher import AES, PKCS1_OAEP
from Crypto.Random import get_random_bytes

def export_history(messages, rsa_public_key, filename):
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
    session_key = get_random_bytes(16)
    
    # –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
    cipher_aes = AES.new(session_key, AES.MODE_EAX)
    ciphertext, tag = cipher_aes.encrypt_and_digest(json.dumps(messages).encode('utf-8'))
    
    # –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
    recipient_key = RSA.import_key(rsa_public_key)
    cipher_rsa = PKCS1_OAEP.new(recipient_key)
    enc_session_key = cipher_rsa.encrypt(session_key)
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ ZIP-–∞—Ä—Ö–∏–≤
    with zipfile.ZipFile(filename, 'w') as zipf:
        zipf.writestr('enc_session_key.bin', enc_session_key)
        zipf.writestr('nonce.bin', cipher_aes.nonce)
        zipf.writestr('tag.bin', tag)
        zipf.writestr('ciphertext.bin', ciphertext)